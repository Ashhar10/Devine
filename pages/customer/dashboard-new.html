<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Account - Devine Water</title>
    <link rel="stylesheet" href="../../assets/css/base.css" />
    <link rel="stylesheet" href="../../assets/css/components.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../config.js"></script>
</head>

<body style="background: #F9FAFB;">
    <!-- Navigation Tabs -->
    <nav style="background: white; border-bottom: 1px solid #E5E7EB; padding: 0;">
        <div class="container" style="max-width: 1200px; margin: 0 auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 24px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="../../assets/logo.png" alt="Logo" style="width: 40px; height: 40px;"
                        onerror="this.style.display='none'">
                    <span style="font-weight: 700; font-size: 18px; color: #111827;">Devine Water</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 14px; color: #6B7280;">Sunday, November 23 2025</span>
                    <div style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <span id="user-name" style="font-size: 14px; font-weight: 500; color: #111827;"></span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>
            </div>
            <div id="nav-tabs" style="display: flex; gap: 32px; padding: 0 24px;">
                <a href="./dashboard.html" class="nav-tab active"
                    style="padding: 12px 0; font-size: 14px; font-weight: 500; color: #4F46E5; border-bottom: 2px solid #4F46E5; text-decoration: none;">Dashboard</a>
                <a href="./consumption.html" class="nav-tab"
                    style="padding: 12px 0; font-size: 14px; font-weight: 500; color: #6B7280; border-bottom: 2px solid transparent; text-decoration: none;">Consumption</a>
                <a href="./financial.html" class="nav-tab"
                    style="padding: 12px 0; font-size: 14px; font-weight: 500; color: #6B7280; border-bottom: 2px solid transparent; text-decoration: none;">Financial</a>
                <a href="./deliveries.html" class="nav-tab"
                    style="padding: 12px 0; font-size: 14px; font-weight: 500; color: #6B7280; border-bottom: 2px solid transparent; text-decoration: none;">Deliveries</a>
                <a href="./calendar.html" class="nav-tab"
                    style="padding: 12px 0; font-size: 14px; font-weight: 500; color: #6B7280; border-bottom: 2px solid transparent; text-decoration: none;">Calendar</a>
                <a href="./bottle-request.html" class="nav-tab"
                    style="padding: 12px 0; font-size: 14px; font-weight: 500; color: #6B7280; border-bottom: 2px solid transparent; text-decoration: none;">Bottle
                    Request</a>
            </div>
        </div>
    </nav>

    <main style="padding: 40px 24px;">
        <div class="container" style="max-width: 1200px; margin: 0 auto;">
            <h1 style="font-size: 28px; font-weight: 700; color: #111827; margin-bottom: 32px;">My Account</h1>

            <!-- Metric Cards -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 24px;">
                <!-- Total Delivered -->
                <div class="metric-card">
                    <div class="metric-card-icon blue">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                        </svg>
                    </div>
                    <div class="metric-card-value" id="total-delivered">77</div>
                    <div class="metric-card-label">Total Delivered</div>
                    <a href="#" class="metric-card-link">View Analytics →</a>
                </div>

                <!-- Amount Due -->
                <div class="metric-card">
                    <div class="metric-card-icon red">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="metric-card-value" id="amount-due" style="color: #DC2626;">PKR 1,600</div>
                    <div class="metric-card-label">Amount Due</div>
                    <a href="#" class="metric-card-link">View Details →</a>
                </div>

                <!-- Empty Returned -->
                <div class="metric-card">
                    <div class="metric-card-icon orange">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </div>
                    <div class="metric-card-value" id="empty-returned">74</div>
                    <div class="metric-card-label">Empty Returned</div>
                    <a href="#" class="metric-card-link">All Time</a>
                </div>

                <!-- Bottle Balance -->
                <div class="metric-card">
                    <div class="metric-card-icon purple">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div class="metric-card-value" id="bottle-balance">3</div>
                    <div class="metric-card-label">Bottle Balance</div>
                    <a href="./calendar.html" class="metric-card-link">View Calendar →</a>
                </div>
            </div>

            <!-- App Install Banner -->
            <div
                style="background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); border-radius: 16px; padding: 20px 24px; margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; color: white;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div
                        style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                        </svg>
                    </div>
                    <div>
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">Install AqaaDelivery App
                        </div>
                        <div style="font-size: 14px; opacity: 0.9;">Get quick access from your home screen</div>
                    </div>
                </div>
                <button
                    style="background: white; color: #4F46E5; padding: 10px 24px; border-radius: 8px; font-weight: 600; font-size: 14px; border: none; cursor: pointer;">Install</button>
                <button id="close-banner"
                    style="background: transparent; border: none; color: white; cursor: pointer; font-size: 24px; margin-left: 16px;">×</button>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions" style="margin-bottom: 32px;">
                <a href="./bottle-request.html" class="quick-action-btn">
                    <div class="quick-action-icon" style="background: #ECFDF5; color: #10B981;">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                    </div>
                    <div class="quick-action-label">Quick Order</div>
                </a>
                <a href="./deliveries.html" class="quick-action-btn">
                    <div class="quick-action-icon" style="background: #DBEAFE; color: #3B82F6;">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                    </div>
                    <div class="quick-action-label">View Deliveries</div>
                </a>
                <a href="./calendar.html" class="quick-action-btn">
                    <div class="quick-action-icon" style="background: #FEF2F2; color: #DC2626;">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div class="quick-action-label">Calendar</div>
                </a>
                <a href="./consumption.html" class="quick-action-btn">
                    <div class="quick-action-icon" style="background: #FFEDD5; color: #F59E0B;">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div class="quick-action-label">Analytics</div>
                </a>
            </div>

            <!-- Two Column Layout -->
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px;">
                <!-- Subscription Status -->
                <div class="info-panel">
                    <div class="info-panel-header">Subscription Status</div>
                    <div class="info-panel-row">
                        <span class="info-panel-label">Quantity per delivery</span>
                        <span class="info-panel-value" id="sub-quantity">2 bottles</span>
                    </div>
                    <div class="info-panel-row">
                        <span class="info-panel-label">Frequency</span>
                        <span class="info-panel-value" id="sub-frequency">Every 3 days</span>
                    </div>
                    <div class="info-panel-row">
                        <span class="info-panel-label">Next delivery</span>
                        <span class="info-panel-value primary" id="sub-next">Nov 23, 2025</span>
                    </div>
                    <div class="info-panel-row">
                        <span class="info-panel-label">Status</span>
                        <span class="badge-new badge-active" id="sub-status">Active</span>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div
                    style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Recent Orders</div>
                    <div id="recent-orders" style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- Orders will be loaded here -->
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button onclick="location.href='./deliveries.html'"
                            style="flex: 1; background: white; border: 1px solid #4F46E5; color: #4F46E5; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                style="display: inline; vertical-align: middle; margin-right: 8px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            View All Orders
                        </button>
                        <button onclick="location.href='./bottle-request.html'"
                            style="flex: 1; background: #10B981; color: white; padding: 12px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                style="display: inline; vertical-align: middle; margin-right: 8px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4" />
                            </svg>
                            Request for Bottles
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { state } from '../../assets/js/state.js';
        import { calculateMonthlyBill, calculateBalance } from '../../assets/js/utils.js';

        // Load data
        async function loadDashboard() {
            try {
                // Check session
                const response = await fetch(`${API_BASE}/auth/check`, {
                    credentials: 'include'
                });

                if (!response.ok) {
                    location.href = '../../login.html';
                    return;
                }

                const { user } = await response.json();
                if (user.role !== 'customer') {
                    location.href = '../../login.html';
                    return;
                }

                state.currentUser = user;
                state.userType = 'customer';

                // Update UI
                document.getElementById('user-name').textContent = user.name;
                document.getElementById('total-delivered').textContent = user.totalBottles || 77;
                document.getElementById('empty-returned').textContent = user.deliveries?.reduce((sum, d) => sum + (d.quantity || 0), 0) || 74;
                document.getElementById('bottle-balance').textContent = (user.totalBottles || 77) - (user.deliveries?.reduce((sum, d) => sum + (d.quantity || 0), 0) || 74);

                // Load recent orders
                loadRecentOrders();
            } catch (error) {
                console.error('Failed to load dashboard:', error);
                location.href = '../../login.html';
            }
        }

        function loadRecentOrders() {
            const ordersContainer = document.getElementById('recent-orders');
            const mockOrders = [
                { bottles: 2, price: 160, date: 'Nov 22, 2025', status: 'delivered' },
                { bottles: 3, price: 240, date: 'Nov 16, 2025', status: 'delivered' },
                { bottles: 2, price: 160, date: 'Nov 12, 2025', status: 'delivered' }
            ];

            ordersContainer.innerHTML = mockOrders.map(order => `
        <div style="display: flex; justify-content: space-between; padding: 16px; background: #F9FAFB; border-radius: 12px;">
          <div>
            <div style="font-weight: 600; color: #111827; margin-bottom: 4px;">${order.bottles} bottles</div>
            <div style="font-size: 13px; color: #6B7280;">PKR ${order.price}</div>
            <div style="font-size: 13px; color: #6B7280;">${order.date}</div>
          </div>
          <div>
            <span class="badge-new badge-delivered">Delivered</span>
          </div>
        </div>
      `).join('');
        }

        // Close banner
        document.getElementById('close-banner')?.addEventListener('click', (e) => {
            e.target.closest('[style*="background: linear-gradient"]').remove();
        });

        loadDashboard();
    </script>
</body>

</html>